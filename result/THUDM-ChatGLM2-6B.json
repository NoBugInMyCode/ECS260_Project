{
    "https://api.github.com/repos/THUDM/ChatGLM2-6B": {
        "forks": 1855,
        "watchers": 15759,
        "stars": 15759,
        "languages": {
            "Python": 68609,
            "Shell": 3948
        },
        "commits": [
            "2024-06-27T04:05:08Z",
            "2024-06-27T04:00:39Z",
            "2024-06-27T03:59:33Z",
            "2024-04-11T03:30:55Z",
            "2023-10-27T06:25:31Z",
            "2023-09-11T07:40:36Z",
            "2023-09-04T15:47:55Z",
            "2023-08-28T02:51:52Z",
            "2023-08-25T13:22:17Z",
            "2023-07-31T09:33:12Z",
            "2023-07-27T11:42:47Z",
            "2023-07-26T14:23:15Z",
            "2023-07-26T14:16:39Z",
            "2023-07-26T01:19:49Z",
            "2023-07-19T14:40:00Z",
            "2023-07-19T14:21:32Z",
            "2023-07-17T09:06:10Z",
            "2023-07-17T06:41:48Z",
            "2023-07-17T03:41:23Z",
            "2023-07-16T07:21:19Z",
            "2023-07-14T11:15:45Z",
            "2023-07-14T11:15:30Z",
            "2023-07-14T11:13:25Z",
            "2023-07-14T11:11:56Z",
            "2023-07-14T11:03:18Z",
            "2023-07-12T08:52:13Z",
            "2023-07-11T08:41:34Z",
            "2023-07-08T02:31:56Z",
            "2023-07-07T14:44:33Z",
            "2023-07-07T08:09:00Z"
        ],
        "creation_date": "2023-06-24T06:21:34Z",
        "contributors": 12,
        "topics": [
            "chatglm",
            "chatglm-6b",
            "large-language-models",
            "llm"
        ],
        "subscribers": 132,
        "readme": "# ChatGLM2-6B\n\n<p align=\"center\">\n\ud83e\udd17 <a href=\"https://huggingface.co/THUDM/chatglm2-6b\" target=\"_blank\">HF Repo</a> \u2022 \ud83d\udc26 <a href=\"https://twitter.com/thukeg\" target=\"_blank\">Twitter</a> \u2022 \ud83d\udcc3 <a href=\"https://arxiv.org/abs/2103.10360\" target=\"_blank\">[GLM@ACL 22]</a> <a href=\"https://github.com/THUDM/GLM\" target=\"_blank\">[GitHub]</a> \u2022 \ud83d\udcc3 <a href=\"https://arxiv.org/abs/2210.02414\" target=\"_blank\">[GLM-130B@ICLR 23]</a> <a href=\"https://github.com/THUDM/GLM-130B\" target=\"_blank\">[GitHub]</a> <br>\n</p>\n<p align=\"center\">\n    \ud83d\udc4b \u52a0\u5165\u6211\u4eec\u7684  <a href=\"https://discord.gg/fK2dz4bg\" target=\"_blank\">Discord</a> \u548c <a href=\"resources/WECHAT.md\" target=\"_blank\">WeChat</a>\n</p>\n<p align=\"center\">\n\ud83d\udccd\u5728 <a href=\"https://www.chatglm.cn\">chatglm.cn</a> \u4f53\u9a8c\u66f4\u5927\u89c4\u6a21\u7684 ChatGLM \u6a21\u578b\u3002\n</p>\n\n\n*Read this in [English](README_EN.md)*\n\n## GLM-4 \u5f00\u6e90\u6a21\u578b\u548cAPI\n\n\u6211\u4eec\u5df2\u7ecf\u53d1\u5e03\u6700\u65b0\u7684 **GLM-4** \u6a21\u578b\uff0c\u8be5\u6a21\u578b\u5728\u591a\u4e2a\u6307\u6807\u4e0a\u6709\u4e86\u65b0\u7684\u7a81\u7834\uff0c\u60a8\u53ef\u4ee5\u5728\u4ee5\u4e0b\u4e24\u4e2a\u6e20\u9053\u4f53\u9a8c\u6211\u4eec\u7684\u6700\u65b0\u6a21\u578b\u3002\n\n+ [GLM-4 \u5f00\u6e90\u6a21\u578b](https://github.com/THUDM/GLM-4) \u6211\u4eec\u5df2\u7ecf\u5f00\u6e90\u4e86 GLM-4-9B \u7cfb\u5217\u6a21\u578b\uff0c\u5728\u5404\u9879\u6307\u6807\u7684ce\u662f\u4e0a\u6709\u660e\u663e\u63d0\u5347\uff0c\u6b22\u8fce\u5c1d\u8bd5\u3002\n+ [\u667a\u8c31\u6e05\u8a00](https://chatglm.cn/main/detail?fr=ecology_x) \u4f53\u9a8c\u6700\u65b0\u7248 GLM-4\uff0c\u5305\u62ec **GLMs\uff0cAll tools**\u7b49\u529f\u80fd\u3002\n+ [API\u5e73\u53f0](https://open.bigmodel.cn/?utm_campaign=open&_channel_track_key=OWTVNma9) \u65b0\u4e00\u4ee3 API \u5e73\u53f0\u5df2\u7ecf\u4e0a\u7ebf\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u5728\n  API\n  \u5e73\u53f0\u4e0a\u4f53\u9a8c `GLM-4-0520`\u3001`GLM-4-air`\u3001`GLM-4-airx`\u3001`GLM-4-flash`\u3001`GLM-4`\u3001`GLM-3-Turbo`\u3001`CharacterGLM-3`\uff0c`CogView-3`\n  \u7b49\u65b0\u6a21\u578b\u3002\n  \u5176\u4e2d`GLM-4`\u3001`GLM-3-Turbo`\u4e24\u4e2a\u6a21\u578b\u652f\u6301\u4e86 `System Prompt`\u3001`Function Call`\u3001 `Retrieval`\u3001`Web_Search`\u7b49\u65b0\u529f\u80fd\uff0c\u6b22\u8fce\u4f53\u9a8c\u3002\n\n+ [GLM-4 API \u5f00\u6e90\u6559\u7a0b](https://github.com/MetaGLM/glm-cookbook/) GLM-4 API\u6559\u7a0b\u548c\u57fa\u7840\u5e94\u7528\uff0c\u6b22\u8fce\u5c1d\u8bd5\u3002\n  API\u76f8\u5173\u95ee\u9898\u53ef\u4ee5\u5728\u672c\u5f00\u6e90\u6559\u7a0b\u7591\u95ee\uff0c\u6216\u8005\u4f7f\u7528 [GLM-4 API AI\u52a9\u624b](https://open.bigmodel.cn/shareapp/v1/?share_code=sQwt5qyqYVaNh1O_87p8O)\n  \u6765\u83b7\u5f97\u5e38\u89c1\u95ee\u9898\u7684\u5e2e\u52a9\u3002\n\n-----\n\n## \u4ecb\u7ecd\n\nChatGLM**2**-6B \u662f\u5f00\u6e90\u4e2d\u82f1\u53cc\u8bed\u5bf9\u8bdd\u6a21\u578b [ChatGLM-6B](https://github.com/THUDM/ChatGLM-6B) \u7684\u7b2c\u4e8c\u4ee3\u7248\u672c\uff0c\u5728\u4fdd\u7559\u4e86\u521d\u4ee3\u6a21\u578b\u5bf9\u8bdd\u6d41\u7545\u3001\u90e8\u7f72\u95e8\u69db\u8f83\u4f4e\u7b49\u4f17\u591a\u4f18\u79c0\u7279\u6027\u7684\u57fa\u7840\u4e4b\u4e0a\uff0cChatGLM**2**-6B \u5f15\u5165\u4e86\u5982\u4e0b\u65b0\u7279\u6027\uff1a\n\n1. **\u66f4\u5f3a\u5927\u7684\u6027\u80fd**\uff1a\u57fa\u4e8e ChatGLM \u521d\u4ee3\u6a21\u578b\u7684\u5f00\u53d1\u7ecf\u9a8c\uff0c\u6211\u4eec\u5168\u9762\u5347\u7ea7\u4e86 ChatGLM2-6B \u7684\u57fa\u5ea7\u6a21\u578b\u3002ChatGLM2-6B \u4f7f\u7528\u4e86 [GLM](https://github.com/THUDM/GLM) \u7684\u6df7\u5408\u76ee\u6807\u51fd\u6570\uff0c\u7ecf\u8fc7\u4e86 1.4T \u4e2d\u82f1\u6807\u8bc6\u7b26\u7684\u9884\u8bad\u7ec3\u4e0e\u4eba\u7c7b\u504f\u597d\u5bf9\u9f50\u8bad\u7ec3\uff0c[\u8bc4\u6d4b\u7ed3\u679c](#\u8bc4\u6d4b\u7ed3\u679c)\u663e\u793a\uff0c\u76f8\u6bd4\u4e8e\u521d\u4ee3\u6a21\u578b\uff0cChatGLM2-6B \u5728 MMLU\uff08+23%\uff09\u3001CEval\uff08+33%\uff09\u3001GSM8K\uff08+571%\uff09 \u3001BBH\uff08+60%\uff09\u7b49\u6570\u636e\u96c6\u4e0a\u7684\u6027\u80fd\u53d6\u5f97\u4e86\u5927\u5e45\u5ea6\u7684\u63d0\u5347\uff0c\u5728\u540c\u5c3a\u5bf8\u5f00\u6e90\u6a21\u578b\u4e2d\u5177\u6709\u8f83\u5f3a\u7684\u7ade\u4e89\u529b\u3002\n2. **\u66f4\u957f\u7684\u4e0a\u4e0b\u6587**\uff1a\u57fa\u4e8e [FlashAttention](https://github.com/HazyResearch/flash-attention) \u6280\u672f\uff0c\u6211\u4eec\u5c06\u57fa\u5ea7\u6a21\u578b\u7684\u4e0a\u4e0b\u6587\u957f\u5ea6\uff08Context Length\uff09\u7531 ChatGLM-6B \u7684 2K \u6269\u5c55\u5230\u4e86 32K\uff0c\u5e76\u5728\u5bf9\u8bdd\u9636\u6bb5\u4f7f\u7528 8K \u7684\u4e0a\u4e0b\u6587\u957f\u5ea6\u8bad\u7ec3\u3002\u5bf9\u4e8e\u66f4\u957f\u7684\u4e0a\u4e0b\u6587\uff0c\u6211\u4eec\u53d1\u5e03\u4e86 [ChatGLM2-6B-32K](https://huggingface.co/THUDM/chatglm2-6b-32k) \u6a21\u578b\u3002[LongBench](https://github.com/THUDM/LongBench) \u7684\u6d4b\u8bc4\u7ed3\u679c\u8868\u660e\uff0c\u5728\u7b49\u91cf\u7ea7\u7684\u5f00\u6e90\u6a21\u578b\u4e2d\uff0cChatGLM2-6B-32K \u6709\u7740\u8f83\u4e3a\u660e\u663e\u7684\u7ade\u4e89\u4f18\u52bf\u3002\n3. **\u66f4\u9ad8\u6548\u7684\u63a8\u7406**\uff1a\u57fa\u4e8e [Multi-Query Attention](http://arxiv.org/abs/1911.02150) \u6280\u672f\uff0cChatGLM2-6B \u6709\u66f4\u9ad8\u6548\u7684\u63a8\u7406\u901f\u5ea6\u548c\u66f4\u4f4e\u7684\u663e\u5b58\u5360\u7528\uff1a\u5728\u5b98\u65b9\u7684\u6a21\u578b\u5b9e\u73b0\u4e0b\uff0c\u63a8\u7406\u901f\u5ea6\u76f8\u6bd4\u521d\u4ee3\u63d0\u5347\u4e86 42%\uff0cINT4 \u91cf\u5316\u4e0b\uff0c6G \u663e\u5b58\u652f\u6301\u7684\u5bf9\u8bdd\u957f\u5ea6\u7531 1K \u63d0\u5347\u5230\u4e86 8K\u3002\n4. **\u66f4\u5f00\u653e\u7684\u534f\u8bae**\uff1aChatGLM2-6B \u6743\u91cd\u5bf9\u5b66\u672f\u7814\u7a76**\u5b8c\u5168\u5f00\u653e**\uff0c\u5728\u586b\u5199[\u95ee\u5377](https://open.bigmodel.cn/mla/form)\u8fdb\u884c\u767b\u8bb0\u540e**\u4ea6\u5141\u8bb8\u514d\u8d39\u5546\u4e1a\u4f7f\u7528**\u3002\n\n-----\n\nChatGLM2-6B \u5f00\u6e90\u6a21\u578b\u65e8\u5728\u4e0e\u5f00\u6e90\u793e\u533a\u4e00\u8d77\u63a8\u52a8\u5927\u6a21\u578b\u6280\u672f\u53d1\u5c55\uff0c\u6073\u8bf7\u5f00\u53d1\u8005\u548c\u5927\u5bb6\u9075\u5b88[\u5f00\u6e90\u534f\u8bae](MODEL_LICENSE)\uff0c\u52ff\u5c06\u5f00\u6e90\u6a21\u578b\u548c\u4ee3\u7801\u53ca\u57fa\u4e8e\u5f00\u6e90\u9879\u76ee\u4ea7\u751f\u7684\u884d\u751f\u7269\u7528\u4e8e\u4efb\u4f55\u53ef\u80fd\u7ed9\u56fd\u5bb6\u548c\u793e\u4f1a\u5e26\u6765\u5371\u5bb3\u7684\u7528\u9014\u4ee5\u53ca\u7528\u4e8e\u4efb\u4f55\u672a\u7ecf\u8fc7\u5b89\u5168\u8bc4\u4f30\u548c\u5907\u6848\u7684\u670d\u52a1\u3002**\u76ee\u524d\uff0c\u672c\u9879\u76ee\u56e2\u961f\u672a\u57fa\u4e8e ChatGLM2-6B \u5f00\u53d1\u4efb\u4f55\u5e94\u7528\uff0c\u5305\u62ec\u7f51\u9875\u7aef\u3001\u5b89\u5353\u3001\u82f9\u679c iOS \u53ca Windows App \u7b49\u5e94\u7528\u3002**\n\n\u5c3d\u7ba1\u6a21\u578b\u5728\u8bad\u7ec3\u7684\u5404\u4e2a\u9636\u6bb5\u90fd\u5c3d\u529b\u786e\u4fdd\u6570\u636e\u7684\u5408\u89c4\u6027\u548c\u51c6\u786e\u6027\uff0c\u4f46\u7531\u4e8e ChatGLM2-6B \u6a21\u578b\u89c4\u6a21\u8f83\u5c0f\uff0c\u4e14\u6a21\u578b\u53d7\u6982\u7387\u968f\u673a\u6027\u56e0\u7d20\u5f71\u54cd\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u8f93\u51fa\u5185\u5bb9\u7684\u51c6\u786e\u6027\uff0c\u4e14\u6a21\u578b\u6613\u88ab\u8bef\u5bfc\u3002**\u672c\u9879\u76ee\u4e0d\u627f\u62c5\u5f00\u6e90\u6a21\u578b\u548c\u4ee3\u7801\u5bfc\u81f4\u7684\u6570\u636e\u5b89\u5168\u3001\u8206\u60c5\u98ce\u9669\u6216\u53d1\u751f\u4efb\u4f55\u6a21\u578b\u88ab\u8bef\u5bfc\u3001\u6ee5\u7528\u3001\u4f20\u64ad\u3001\u4e0d\u5f53\u5229\u7528\u800c\u4ea7\u751f\u7684\u98ce\u9669\u548c\u8d23\u4efb\u3002**\n\n## \u66f4\u65b0\u4fe1\u606f\n**[2023/07/31]** \u53d1\u5e03 [ChatGLM2-6B-32K](https://huggingface.co/THUDM/chatglm2-6b-32k) \u6a21\u578b\uff0c\u63d0\u5347\u5bf9\u4e8e\u957f\u6587\u672c\u7684\u7406\u89e3\u80fd\u529b\u3002\n\n**[2023/07/25]** \u53d1\u5e03 [CodeGeeX2](https://github.com/THUDM/CodeGeeX2) \u6a21\u578b\uff0c\u57fa\u4e8e ChatGLM2-6B \u52a0\u5165\u4ee3\u7801\u9884\u8bad\u7ec3\u5b9e\u73b0\uff0c\u4ee3\u7801\u80fd\u529b\u5168\u9762\u63d0\u5347\u3002\n\n**[2023/07/04]** \u53d1\u5e03 P-Tuning v2 \u4e0e \u5168\u53c2\u6570\u5fae\u8c03\u811a\u672c\uff0c\u53c2\u89c1 [P-Tuning](./ptuning)\u3002\n\n## \u53cb\u60c5\u94fe\u63a5\n\u5bf9 ChatGLM2 \u8fdb\u884c\u52a0\u901f\u7684\u5f00\u6e90\u9879\u76ee\uff1a\n* [fastllm](https://github.com/ztxz16/fastllm/): \u5168\u5e73\u53f0\u52a0\u901f\u63a8\u7406\u65b9\u6848\uff0c\u5355GPU\u6279\u91cf\u63a8\u7406\u6bcf\u79d2\u53ef\u8fbe10000+token\uff0c\u624b\u673a\u7aef\u6700\u4f4e3G\u5185\u5b58\u5b9e\u65f6\u8fd0\u884c\uff08\u9a81\u9f99865\u4e0a\u7ea64~5 token/s\uff09\n* [chatglm.cpp](https://github.com/li-plus/chatglm.cpp): \u7c7b\u4f3c llama.cpp \u7684 CPU \u91cf\u5316\u52a0\u901f\u63a8\u7406\u65b9\u6848\uff0c\u5b9e\u73b0 Mac \u7b14\u8bb0\u672c\u4e0a\u5b9e\u65f6\u5bf9\u8bdd\n* [ChatGLM2-TPU](https://github.com/sophgo/ChatGLM2-TPU): \u91c7\u7528TPU\u52a0\u901f\u63a8\u7406\u65b9\u6848\uff0c\u5728\u7b97\u80fd\u7aef\u4fa7\u82af\u7247BM1684X\uff0816T@FP16\uff0c\u5185\u5b5816G\uff09\u4e0a\u5b9e\u65f6\u8fd0\u884c\u7ea65 token/s\n\n\u57fa\u4e8e\u6216\u4f7f\u7528\u4e86 ChatGLM2-6B \u7684\u5f00\u6e90\u9879\u76ee\uff1a\n* [Chuanhu Chat](https://github.com/GaiZhenbiao/ChuanhuChatGPT): \u4e3a\u5404\u4e2a\u5927\u8bed\u8a00\u6a21\u578b\u548c\u5728\u7ebf\u6a21\u578bAPI\u63d0\u4f9b\u7f8e\u89c2\u6613\u7528\u3001\u529f\u80fd\u4e30\u5bcc\u3001\u5feb\u901f\u90e8\u7f72\u7684\u7528\u6237\u754c\u9762\uff0c\u652f\u6301ChatGLM2-6B\u3002\n\n\u652f\u6301 ChatGLM-6B \u548c\u76f8\u5173\u5e94\u7528\u5728\u7ebf\u8bad\u7ec3\u7684\u793a\u4f8b\u9879\u76ee\uff1a\n* [ChatGLM2-6B \u5728\u817e\u8baf\u4e91\u90e8\u7f72\u6559\u7a0b](https://cloud.tencent.com/document/product/1721/104848)\n* [ChatGLM2-6B \u7684\u90e8\u7f72\u4e0e\u5fae\u8c03\u6559\u7a0b](https://www.heywhale.com/mw/project/64984a7b72ebe240516ae79c)\n\n## \u8bc4\u6d4b\u7ed3\u679c\n\u6211\u4eec\u9009\u53d6\u4e86\u90e8\u5206\u4e2d\u82f1\u6587\u5178\u578b\u6570\u636e\u96c6\u8fdb\u884c\u4e86\u8bc4\u6d4b\uff0c\u4ee5\u4e0b\u4e3a ChatGLM2-6B \u6a21\u578b\u5728 [MMLU](https://github.com/hendrycks/test) (\u82f1\u6587)\u3001[C-Eval](https://cevalbenchmark.com/static/leaderboard.html)\uff08\u4e2d\u6587\uff09\u3001[GSM8K](https://github.com/openai/grade-school-math)\uff08\u6570\u5b66\uff09\u3001[BBH](https://github.com/suzgunmirac/BIG-Bench-Hard)\uff08\u82f1\u6587\uff09 \u4e0a\u7684\u6d4b\u8bc4\u7ed3\u679c\u3002\u5728 [evaluation](./evaluation/README.md) \u4e2d\u63d0\u4f9b\u4e86\u5728 C-Eval \u4e0a\u8fdb\u884c\u6d4b\u8bc4\u7684\u811a\u672c\u3002\n\n### MMLU\n\n| Model | Average | STEM | Social Sciences | Humanities | Others |\n| ----- |------| ---- |------|-------| ----- |\n| ChatGLM-6B | 40.63 | 33.89 | 44.84 | 39.02 | 45.71 |\n| ChatGLM2-6B (base) | 47.86 | 41.20 | 54.44 | 43.66 | 54.46 |\n| ChatGLM2-6B | 45.46 | 40.06 | 51.61 | 41.23 | 51.24 |\n| ChatGLM2-12B (base) | 56.18 | 48.18 | 65.13 | 52.58 | 60.93 |\n| ChatGLM2-12B | 52.13 | 47.00 | 61.00 | 46.10 | 56.05 |\n\n> Chat \u6a21\u578b\u4f7f\u7528 zero-shot CoT (Chain-of-Thought) \u7684\u65b9\u6cd5\u6d4b\u8bd5\uff0cBase \u6a21\u578b\u4f7f\u7528 few-shot answer-only \u7684\u65b9\u6cd5\u6d4b\u8bd5\n\n### C-Eval\n\n| Model | Average | STEM  | Social Sciences | Humanities | Others |\n| ----- |---------|-------| ----- |------------|--------|\n| ChatGLM-6B | 38.9    | 33.3  | 48.3 | 41.3       | 38.0   |\n| ChatGLM2-6B (base) | 51.7    | 48.6  | 60.5 | 51.3       | 49.8   |\n| ChatGLM2-6B | 50.1    | 46.4\t | 60.4 | 50.6       | 46.9   |\n| ChatGLM2-12B (base) | 61.6    | 55.4\t | 73.7 | 64.2       | 59.4   | \n| ChatGLM2-12B | 57.0    | 52.1\t | 69.3 | 58.5       | 53.2   | \n\n> Chat \u6a21\u578b\u4f7f\u7528 zero-shot CoT \u7684\u65b9\u6cd5\u6d4b\u8bd5\uff0cBase \u6a21\u578b\u4f7f\u7528 few-shot answer only \u7684\u65b9\u6cd5\u6d4b\u8bd5\n\n### GSM8K\n\n| Model        | Accuracy | Accuracy (Chinese)* |\n|--------------|----------| - |\n| ChatGLM-6B   | 4.82     | 5.85 |\n| ChatGLM2-6B (base) | 32.37    | 28.95 |\n| ChatGLM2-6B  | 28.05    | 20.45 |\n| ChatGLM2-12B (base) | 40.94    | 42.71 |\n| ChatGLM2-12B | 38.13    | 23.43 |\n\n> \u6240\u6709\u6a21\u578b\u5747\u4f7f\u7528 few-shot CoT \u7684\u65b9\u6cd5\u6d4b\u8bd5\uff0cCoT prompt \u6765\u81ea http://arxiv.org/abs/2201.11903\n> \n> \\* \u6211\u4eec\u4f7f\u7528\u7ffb\u8bd1 API \u7ffb\u8bd1\u4e86 GSM8K \u4e2d\u7684 500 \u9053\u9898\u76ee\u548c CoT prompt \u5e76\u8fdb\u884c\u4e86\u4eba\u5de5\u6821\u5bf9\n\n\n### BBH\n\n| Model        | Accuracy |\n|--------------|-------|\n| ChatGLM-6B   | 18.73 |\n| ChatGLM2-6B (base) | 33.68 |\n| ChatGLM2-6B  | 30.00 |\n| ChatGLM2-12B (base) | 36.02 |\n| ChatGLM2-12B | 39.98 |\n\n> \u6240\u6709\u6a21\u578b\u5747\u4f7f\u7528 few-shot CoT \u7684\u65b9\u6cd5\u6d4b\u8bd5\uff0cCoT prompt \u6765\u81ea https://github.com/suzgunmirac/BIG-Bench-Hard/tree/main/cot-prompts\n\n## \u63a8\u7406\u6027\u80fd\nChatGLM2-6B \u4f7f\u7528\u4e86 [Multi-Query Attention](http://arxiv.org/abs/1911.02150)\uff0c\u63d0\u9ad8\u4e86\u751f\u6210\u901f\u5ea6\u3002\u751f\u6210 2000 \u4e2a\u5b57\u7b26\u7684\u5e73\u5747\u901f\u5ea6\u5bf9\u6bd4\u5982\u4e0b\n\n| Model | \u63a8\u7406\u901f\u5ea6 (\u5b57\u7b26/\u79d2) |\n| ----  | -----  |\n| ChatGLM-6B  | 31.49 |\n| ChatGLM2-6B | 44.62 |\n\n> \u4f7f\u7528\u5b98\u65b9\u5b9e\u73b0\uff0cbatch size = 1\uff0cmax length = 2048\uff0cbf16 \u7cbe\u5ea6\uff0c\u6d4b\u8bd5\u786c\u4ef6\u4e3a A100-SXM4-80G\uff0c\u8f6f\u4ef6\u73af\u5883\u4e3a PyTorch 2.0.1\n\nMulti-Query Attention \u540c\u65f6\u4e5f\u964d\u4f4e\u4e86\u751f\u6210\u8fc7\u7a0b\u4e2d KV Cache \u7684\u663e\u5b58\u5360\u7528\uff0c\u6b64\u5916\uff0cChatGLM2-6B \u91c7\u7528 Causal Mask \u8fdb\u884c\u5bf9\u8bdd\u8bad\u7ec3\uff0c\u8fde\u7eed\u5bf9\u8bdd\u65f6\u53ef\u590d\u7528\u524d\u9762\u8f6e\u6b21\u7684 KV Cache\uff0c\u8fdb\u4e00\u6b65\u4f18\u5316\u4e86\u663e\u5b58\u5360\u7528\u3002\u56e0\u6b64\uff0c\u4f7f\u7528 6GB \u663e\u5b58\u7684\u663e\u5361\u8fdb\u884c INT4 \u91cf\u5316\u7684\u63a8\u7406\u65f6\uff0c\u521d\u4ee3\u7684 ChatGLM-6B \u6a21\u578b\u6700\u591a\u80fd\u591f\u751f\u6210 1119 \u4e2a\u5b57\u7b26\u5c31\u4f1a\u63d0\u793a\u663e\u5b58\u8017\u5c3d\uff0c\u800c ChatGLM2-6B \u80fd\u591f\u751f\u6210\u81f3\u5c11 8192 \u4e2a\u5b57\u7b26\u3002\n\n| **\u91cf\u5316\u7b49\u7ea7** | **\u7f16\u7801 2048 \u957f\u5ea6\u7684\u6700\u5c0f\u663e\u5b58** | **\u751f\u6210 8192 \u957f\u5ea6\u7684\u6700\u5c0f\u663e\u5b58** |\n| -------------- |---------------------|---------------------|\n| FP16 / BF16 | 13.1 GB             | 12.8 GB             | \n| INT8           | 8.2 GB              | 8.1 GB              |\n| INT4           | 5.5 GB              | 5.1 GB              |\n\n> ChatGLM2-6B \u5229\u7528\u4e86 PyTorch 2.0 \u5f15\u5165\u7684 `torch.nn.functional.scaled_dot_product_attention` \u5b9e\u73b0\u9ad8\u6548\u7684 Attention \u8ba1\u7b97\uff0c\u5982\u679c PyTorch \u7248\u672c\u8f83\u4f4e\u5219\u4f1a fallback \u5230\u6734\u7d20\u7684 Attention \u5b9e\u73b0\uff0c\u51fa\u73b0\u663e\u5b58\u5360\u7528\u9ad8\u4e8e\u4e0a\u8868\u7684\u60c5\u51b5\u3002\n\n\u6211\u4eec\u4e5f\u6d4b\u8bd5\u4e86\u91cf\u5316\u5bf9\u6a21\u578b\u6027\u80fd\u7684\u5f71\u54cd\u3002\u7ed3\u679c\u8868\u660e\uff0c\u91cf\u5316\u5bf9\u6a21\u578b\u6027\u80fd\u7684\u5f71\u54cd\u5728\u53ef\u63a5\u53d7\u8303\u56f4\u5185\u3002\n\n| \u91cf\u5316\u7b49\u7ea7 | Accuracy (MMLU) | Accuracy (C-Eval dev) |\n| ----- | ----- |-----------------------|\n| BF16 | 45.47 | 53.57                 |\n| INT4 | 43.13 | 50.30                 |\n\n\n\n## ChatGLM2-6B \u793a\u4f8b\n\n\u76f8\u6bd4\u4e8e\u521d\u4ee3\u6a21\u578b\uff0cChatGLM2-6B \u591a\u4e2a\u7ef4\u5ea6\u7684\u80fd\u529b\u90fd\u53d6\u5f97\u4e86\u63d0\u5347\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5bf9\u6bd4\u793a\u4f8b\u3002\u66f4\u591a ChatGLM2-6B \u7684\u53ef\u80fd\uff0c\u7b49\u5f85\u4f60\u6765\u63a2\u7d22\u53d1\u73b0\uff01\n\n<details><summary><b>\u6570\u7406\u903b\u8f91</b></summary>\n\n![](resources/math.png)\n\n</details>\n\n<details><summary><b>\u77e5\u8bc6\u63a8\u7406</b></summary>\n\n![](resources/knowledge.png)\n\n</details>\n\n<details><summary><b>\u957f\u6587\u6863\u7406\u89e3</b></summary>\n\n![](resources/long-context.png)\n\n</details>\n\n## \u4f7f\u7528\u65b9\u5f0f\n### \u73af\u5883\u5b89\u88c5\n\u9996\u5148\u9700\u8981\u4e0b\u8f7d\u672c\u4ed3\u5e93\uff1a\n```shell\ngit clone https://github.com/THUDM/ChatGLM2-6B\ncd ChatGLM2-6B\n```\n\n\u7136\u540e\u4f7f\u7528 pip \u5b89\u88c5\u4f9d\u8d56\uff1a\n```\npip install -r requirements.txt\n```\n\u5176\u4e2d `transformers` \u5e93\u7248\u672c\u63a8\u8350\u4e3a `4.30.2`\uff0c`torch` \u63a8\u8350\u4f7f\u7528 2.0 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u4ee5\u83b7\u5f97\u6700\u4f73\u7684\u63a8\u7406\u6027\u80fd\u3002\n\n### \u4ee3\u7801\u8c03\u7528 \n\n\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u4ee3\u7801\u8c03\u7528 ChatGLM2-6B \u6a21\u578b\u6765\u751f\u6210\u5bf9\u8bdd\uff1a\n\n```python\n>>> from transformers import AutoTokenizer, AutoModel\n>>> tokenizer = AutoTokenizer.from_pretrained(\"THUDM/chatglm2-6b\", trust_remote_code=True)\n>>> model = AutoModel.from_pretrained(\"THUDM/chatglm2-6b\", trust_remote_code=True, device='cuda')\n>>> model = model.eval()\n>>> response, history = model.chat(tokenizer, \"\u4f60\u597d\", history=[])\n>>> print(response)\n\u4f60\u597d\ud83d\udc4b!\u6211\u662f\u4eba\u5de5\u667a\u80fd\u52a9\u624b ChatGLM2-6B,\u5f88\u9ad8\u5174\u89c1\u5230\u4f60,\u6b22\u8fce\u95ee\u6211\u4efb\u4f55\u95ee\u9898\u3002\n>>> response, history = model.chat(tokenizer, \"\u665a\u4e0a\u7761\u4e0d\u7740\u5e94\u8be5\u600e\u4e48\u529e\", history=history)\n>>> print(response)\n\u665a\u4e0a\u7761\u4e0d\u7740\u53ef\u80fd\u4f1a\u8ba9\u4f60\u611f\u5230\u7126\u8651\u6216\u4e0d\u8212\u670d,\u4f46\u4ee5\u4e0b\u662f\u4e00\u4e9b\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5165\u7761\u7684\u65b9\u6cd5:\n\n1. \u5236\u5b9a\u89c4\u5f8b\u7684\u7761\u7720\u65f6\u95f4\u8868:\u4fdd\u6301\u89c4\u5f8b\u7684\u7761\u7720\u65f6\u95f4\u8868\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5efa\u7acb\u5065\u5eb7\u7684\u7761\u7720\u4e60\u60ef,\u4f7f\u4f60\u66f4\u5bb9\u6613\u5165\u7761\u3002\u5c3d\u91cf\u5728\u6bcf\u5929\u7684\u76f8\u540c\u65f6\u95f4\u4e0a\u5e8a,\u5e76\u5728\u540c\u4e00\u65f6\u95f4\u8d77\u5e8a\u3002\n2. \u521b\u9020\u4e00\u4e2a\u8212\u9002\u7684\u7761\u7720\u73af\u5883:\u786e\u4fdd\u7761\u7720\u73af\u5883\u8212\u9002,\u5b89\u9759,\u9ed1\u6697\u4e14\u6e29\u5ea6\u9002\u5b9c\u3002\u53ef\u4ee5\u4f7f\u7528\u8212\u9002\u7684\u5e8a\u4e0a\u7528\u54c1,\u5e76\u4fdd\u6301\u623f\u95f4\u901a\u98ce\u3002\n3. \u653e\u677e\u8eab\u5fc3:\u5728\u7761\u524d\u505a\u4e9b\u653e\u677e\u7684\u6d3b\u52a8,\u4f8b\u5982\u6ce1\u4e2a\u70ed\u6c34\u6fa1,\u542c\u4e9b\u8f7b\u67d4\u7684\u97f3\u4e50,\u9605\u8bfb\u4e00\u4e9b\u6709\u8da3\u7684\u4e66\u7c4d\u7b49,\u6709\u52a9\u4e8e\u7f13\u89e3\u7d27\u5f20\u548c\u7126\u8651,\u4f7f\u4f60\u66f4\u5bb9\u6613\u5165\u7761\u3002\n4. \u907f\u514d\u996e\u7528\u542b\u6709\u5496\u5561\u56e0\u7684\u996e\u6599:\u5496\u5561\u56e0\u662f\u4e00\u79cd\u523a\u6fc0\u6027\u7269\u8d28,\u4f1a\u5f71\u54cd\u4f60\u7684\u7761\u7720\u8d28\u91cf\u3002\u5c3d\u91cf\u907f\u514d\u5728\u7761\u524d\u996e\u7528\u542b\u6709\u5496\u5561\u56e0\u7684\u996e\u6599,\u4f8b\u5982\u5496\u5561,\u8336\u548c\u53ef\u4e50\u3002\n5. \u907f\u514d\u5728\u5e8a\u4e0a\u505a\u4e0e\u7761\u7720\u65e0\u5173\u7684\u4e8b\u60c5:\u5728\u5e8a\u4e0a\u505a\u4e9b\u4e0e\u7761\u7720\u65e0\u5173\u7684\u4e8b\u60c5,\u4f8b\u5982\u770b\u7535\u5f71,\u73a9\u6e38\u620f\u6216\u5de5\u4f5c\u7b49,\u53ef\u80fd\u4f1a\u5e72\u6270\u4f60\u7684\u7761\u7720\u3002\n6. \u5c1d\u8bd5\u547c\u5438\u6280\u5de7:\u6df1\u547c\u5438\u662f\u4e00\u79cd\u653e\u677e\u6280\u5de7,\u53ef\u4ee5\u5e2e\u52a9\u4f60\u7f13\u89e3\u7d27\u5f20\u548c\u7126\u8651,\u4f7f\u4f60\u66f4\u5bb9\u6613\u5165\u7761\u3002\u8bd5\u7740\u6162\u6162\u5438\u6c14,\u4fdd\u6301\u51e0\u79d2\u949f,\u7136\u540e\u7f13\u6162\u547c\u6c14\u3002\n\n\u5982\u679c\u8fd9\u4e9b\u65b9\u6cd5\u65e0\u6cd5\u5e2e\u52a9\u4f60\u5165\u7761,\u4f60\u53ef\u4ee5\u8003\u8651\u54a8\u8be2\u533b\u751f\u6216\u7761\u7720\u4e13\u5bb6,\u5bfb\u6c42\u8fdb\u4e00\u6b65\u7684\u5efa\u8bae\u3002\n```\n\n#### \u4ece\u672c\u5730\u52a0\u8f7d\u6a21\u578b\n\u4ee5\u4e0a\u4ee3\u7801\u4f1a\u7531 `transformers` \u81ea\u52a8\u4e0b\u8f7d\u6a21\u578b\u5b9e\u73b0\u548c\u53c2\u6570\u3002\u5b8c\u6574\u7684\u6a21\u578b\u5b9e\u73b0\u5728 [Hugging Face Hub](https://huggingface.co/THUDM/chatglm2-6b)\u3002\u5982\u679c\u4f60\u7684\u7f51\u7edc\u73af\u5883\u8f83\u5dee\uff0c\u4e0b\u8f7d\u6a21\u578b\u53c2\u6570\u53ef\u80fd\u4f1a\u82b1\u8d39\u8f83\u957f\u65f6\u95f4\u751a\u81f3\u5931\u8d25\u3002\u6b64\u65f6\u53ef\u4ee5\u5148\u5c06\u6a21\u578b\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u7136\u540e\u4ece\u672c\u5730\u52a0\u8f7d\u3002\n\n\u4ece Hugging Face Hub \u4e0b\u8f7d\u6a21\u578b\u9700\u8981\u5148[\u5b89\u88c5Git LFS](https://docs.github.com/zh/repositories/working-with-files/managing-large-files/installing-git-large-file-storage)\uff0c\u7136\u540e\u8fd0\u884c\n```Shell\ngit clone https://huggingface.co/THUDM/chatglm2-6b\n```\n\n\u5982\u679c\u4f60\u4ece Hugging Face Hub \u4e0a\u4e0b\u8f7d checkpoint \u7684\u901f\u5ea6\u8f83\u6162\uff0c\u53ef\u4ee5\u53ea\u4e0b\u8f7d\u6a21\u578b\u5b9e\u73b0\n```Shell\nGIT_LFS_SKIP_SMUDGE=1 git clone https://huggingface.co/THUDM/chatglm2-6b\n```\n\u7136\u540e\u4ece[\u8fd9\u91cc](https://cloud.tsinghua.edu.cn/d/674208019e314311ab5c/)\u624b\u52a8\u4e0b\u8f7d\u6a21\u578b\u53c2\u6570\u6587\u4ef6\uff0c\u5e76\u5c06\u4e0b\u8f7d\u7684\u6587\u4ef6\u66ff\u6362\u5230\u672c\u5730\u7684 `chatglm2-6b` \u76ee\u5f55\u4e0b\u3002\n\n\n\u5c06\u6a21\u578b\u4e0b\u8f7d\u5230\u672c\u5730\u4e4b\u540e\uff0c\u5c06\u4ee5\u4e0a\u4ee3\u7801\u4e2d\u7684 `THUDM/chatglm2-6b` \u66ff\u6362\u4e3a\u4f60\u672c\u5730\u7684 `chatglm2-6b` \u6587\u4ef6\u5939\u7684\u8def\u5f84\uff0c\u5373\u53ef\u4ece\u672c\u5730\u52a0\u8f7d\u6a21\u578b\u3002\n\n\u6a21\u578b\u7684\u5b9e\u73b0\u4ecd\u7136\u5904\u5728\u53d8\u52a8\u4e2d\u3002\u5982\u679c\u5e0c\u671b\u56fa\u5b9a\u4f7f\u7528\u7684\u6a21\u578b\u5b9e\u73b0\u4ee5\u4fdd\u8bc1\u517c\u5bb9\u6027\uff0c\u53ef\u4ee5\u5728 `from_pretrained` \u7684\u8c03\u7528\u4e2d\u589e\u52a0 `revision=\"v1.0\"` \u53c2\u6570\u3002`v1.0` \u662f\u5f53\u524d\u6700\u65b0\u7684\u7248\u672c\u53f7\uff0c\u5b8c\u6574\u7684\u7248\u672c\u5217\u8868\u53c2\u89c1 [Change Log](https://huggingface.co/THUDM/chatglm2-6b#change-log)\u3002\n\n### \u7f51\u9875\u7248 Demo\n![web-demo](resources/web-demo.gif)\n\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8\u57fa\u4e8e Gradio \u7684\u7f51\u9875\u7248 demo\uff1a\n```shell\npython web_demo.py\n```\n\n![web-demo](resources/web-demo2.gif)\n\n\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8\u57fa\u4e8e Streamlit \u7684\u7f51\u9875\u7248 demo\uff1a\n```shell\nstreamlit run web_demo2.py\n```\n\n\u7f51\u9875\u7248 demo \u4f1a\u8fd0\u884c\u4e00\u4e2a Web Server\uff0c\u5e76\u8f93\u51fa\u5730\u5740\u3002\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u8f93\u51fa\u7684\u5730\u5740\u5373\u53ef\u4f7f\u7528\u3002 \u7ecf\u6d4b\u8bd5\uff0c\u57fa\u4e8e Streamlit \u7684\u7f51\u9875\u7248 Demo \u4f1a\u66f4\u6d41\u7545\u3002\n\n### \u547d\u4ee4\u884c Demo\n\n![cli-demo](resources/cli-demo.png)\n\n\u8fd0\u884c\u4ed3\u5e93\u4e2d [cli_demo.py](cli_demo.py)\uff1a\n\n```shell\npython cli_demo.py\n```\n\n\u7a0b\u5e8f\u4f1a\u5728\u547d\u4ee4\u884c\u4e2d\u8fdb\u884c\u4ea4\u4e92\u5f0f\u7684\u5bf9\u8bdd\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165\u6307\u793a\u5e76\u56de\u8f66\u5373\u53ef\u751f\u6210\u56de\u590d\uff0c\u8f93\u5165 `clear` \u53ef\u4ee5\u6e05\u7a7a\u5bf9\u8bdd\u5386\u53f2\uff0c\u8f93\u5165 `stop` \u7ec8\u6b62\u7a0b\u5e8f\u3002\n\n### API \u90e8\u7f72\n\u9996\u5148\u9700\u8981\u5b89\u88c5\u989d\u5916\u7684\u4f9d\u8d56 `pip install fastapi uvicorn`\uff0c\u7136\u540e\u8fd0\u884c\u4ed3\u5e93\u4e2d\u7684 [api.py](api.py)\uff1a\n```shell\npython api.py\n```\n\u9ed8\u8ba4\u90e8\u7f72\u5728\u672c\u5730\u7684 8000 \u7aef\u53e3\uff0c\u901a\u8fc7 POST \u65b9\u6cd5\u8fdb\u884c\u8c03\u7528\n```shell\ncurl -X POST \"http://127.0.0.1:8000\" \\\n     -H 'Content-Type: application/json' \\\n     -d '{\"prompt\": \"\u4f60\u597d\", \"history\": []}'\n```\n\u5f97\u5230\u7684\u8fd4\u56de\u503c\u4e3a\n```shell\n{\n  \"response\":\"\u4f60\u597d\ud83d\udc4b\uff01\u6211\u662f\u4eba\u5de5\u667a\u80fd\u52a9\u624b ChatGLM2-6B\uff0c\u5f88\u9ad8\u5174\u89c1\u5230\u4f60\uff0c\u6b22\u8fce\u95ee\u6211\u4efb\u4f55\u95ee\u9898\u3002\",\n  \"history\":[[\"\u4f60\u597d\",\"\u4f60\u597d\ud83d\udc4b\uff01\u6211\u662f\u4eba\u5de5\u667a\u80fd\u52a9\u624b ChatGLM2-6B\uff0c\u5f88\u9ad8\u5174\u89c1\u5230\u4f60\uff0c\u6b22\u8fce\u95ee\u6211\u4efb\u4f55\u95ee\u9898\u3002\"]],\n  \"status\":200,\n  \"time\":\"2023-03-23 21:38:40\"\n}\n```\n\u611f\u8c22 [@hiyouga]() \u5b9e\u73b0\u4e86 OpenAI \u683c\u5f0f\u7684\u6d41\u5f0f API \u90e8\u7f72\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u4efb\u610f\u57fa\u4e8e ChatGPT \u7684\u5e94\u7528\u7684\u540e\u7aef\uff0c\u6bd4\u5982 [ChatGPT-Next-Web](https://github.com/Yidadaa/ChatGPT-Next-Web)\u3002\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u4ed3\u5e93\u4e2d\u7684[openai_api.py](openai_api.py) \u8fdb\u884c\u90e8\u7f72\uff1a\n```shell\npython openai_api.py\n```\n\u8fdb\u884c API \u8c03\u7528\u7684\u793a\u4f8b\u4ee3\u7801\u4e3a\n```python\nimport openai\nif __name__ == \"__main__\":\n    openai.api_base = \"http://localhost:8000/v1\"\n    openai.api_key = \"none\"\n    for chunk in openai.ChatCompletion.create(\n        model=\"chatglm2-6b\",\n        messages=[\n            {\"role\": \"user\", \"content\": \"\u4f60\u597d\"}\n        ],\n        stream=True\n    ):\n        if hasattr(chunk.choices[0].delta, \"content\"):\n            print(chunk.choices[0].delta.content, end=\"\", flush=True)\n```\n\n\n## \u4f4e\u6210\u672c\u90e8\u7f72\n\n### \u6a21\u578b\u91cf\u5316\n\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6a21\u578b\u4ee5 FP16 \u7cbe\u5ea6\u52a0\u8f7d\uff0c\u8fd0\u884c\u4e0a\u8ff0\u4ee3\u7801\u9700\u8981\u5927\u6982 13GB \u663e\u5b58\u3002\u5982\u679c\u4f60\u7684 GPU \u663e\u5b58\u6709\u9650\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4ee5\u91cf\u5316\u65b9\u5f0f\u52a0\u8f7d\u6a21\u578b\uff0c\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a\n\n```python\nmodel = AutoModel.from_pretrained(\"THUDM/chatglm2-6b-int4\",trust_remote_code=True).cuda()\n```\n\n\u6a21\u578b\u91cf\u5316\u4f1a\u5e26\u6765\u4e00\u5b9a\u7684\u6027\u80fd\u635f\u5931\uff0c\u7ecf\u8fc7\u6d4b\u8bd5\uff0cChatGLM2-6B \u5728 4-bit \u91cf\u5316\u4e0b\u4ecd\u7136\u80fd\u591f\u8fdb\u884c\u81ea\u7136\u6d41\u7545\u7684\u751f\u6210\u3002 \u91cf\u5316\u6a21\u578b\u7684\u53c2\u6570\u6587\u4ef6\u4e5f\u53ef\u4ee5\u4ece[\u8fd9\u91cc](https://cloud.tsinghua.edu.cn/d/674208019e314311ab5c/)\u624b\u52a8\u4e0b\u8f7d\u3002\n\n### CPU \u90e8\u7f72\n\n\u5982\u679c\u4f60\u6ca1\u6709 GPU \u786c\u4ef6\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u5728 CPU \u4e0a\u8fdb\u884c\u63a8\u7406\uff0c\u4f46\u662f\u63a8\u7406\u901f\u5ea6\u4f1a\u66f4\u6162\u3002\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff08\u9700\u8981\u5927\u6982 32GB \u5185\u5b58\uff09\n```python\nmodel = AutoModel.from_pretrained(\"THUDM/chatglm2-6b\", trust_remote_code=True).float()\n```\n\u5982\u679c\u4f60\u7684\u5185\u5b58\u4e0d\u8db3\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u91cf\u5316\u540e\u7684\u6a21\u578b\n```python\nmodel = AutoModel.from_pretrained(\"THUDM/chatglm2-6b-int4\",trust_remote_code=True).float()\n```\n\u5728 cpu \u4e0a\u8fd0\u884c\u91cf\u5316\u540e\u7684\u6a21\u578b\u9700\u8981\u5b89\u88c5 `gcc` \u4e0e `openmp`\u3002\u591a\u6570 Linux \u53d1\u884c\u7248\u9ed8\u8ba4\u5df2\u5b89\u88c5\u3002\u5bf9\u4e8e Windows \uff0c\u53ef\u5728\u5b89\u88c5 [TDM-GCC](https://jmeubank.github.io/tdm-gcc/) \u65f6\u52fe\u9009 `openmp`\u3002 Windows \u6d4b\u8bd5\u73af\u5883 `gcc` \u7248\u672c\u4e3a `TDM-GCC 10.3.0`\uff0c Linux \u4e3a `gcc 11.3.0`\u3002\u5728 MacOS \u4e0a\u8bf7\u53c2\u8003 [Q1](FAQ.md#q1)\u3002\n\n### Mac \u90e8\u7f72\n\n\u5bf9\u4e8e\u642d\u8f7d\u4e86 Apple Silicon \u6216\u8005 AMD GPU \u7684 Mac\uff0c\u53ef\u4ee5\u4f7f\u7528 MPS \u540e\u7aef\u6765\u5728 GPU \u4e0a\u8fd0\u884c ChatGLM2-6B\u3002\u9700\u8981\u53c2\u8003 Apple \u7684 [\u5b98\u65b9\u8bf4\u660e](https://developer.apple.com/metal/pytorch) \u5b89\u88c5 PyTorch-Nightly\uff08\u6b63\u786e\u7684\u7248\u672c\u53f7\u5e94\u8be5\u662f2.x.x.dev2023xxxx\uff0c\u800c\u4e0d\u662f 2.x.x\uff09\u3002\n\n\u76ee\u524d\u5728 MacOS \u4e0a\u53ea\u652f\u6301[\u4ece\u672c\u5730\u52a0\u8f7d\u6a21\u578b](README.md#\u4ece\u672c\u5730\u52a0\u8f7d\u6a21\u578b)\u3002\u5c06\u4ee3\u7801\u4e2d\u7684\u6a21\u578b\u52a0\u8f7d\u6539\u4e3a\u4ece\u672c\u5730\u52a0\u8f7d\uff0c\u5e76\u4f7f\u7528 mps \u540e\u7aef\uff1a\n```python\nmodel = AutoModel.from_pretrained(\"your local path\", trust_remote_code=True).to('mps')\n```\n\n\u52a0\u8f7d\u534a\u7cbe\u5ea6\u7684 ChatGLM2-6B \u6a21\u578b\u9700\u8981\u5927\u6982 13GB \u5185\u5b58\u3002\u5185\u5b58\u8f83\u5c0f\u7684\u673a\u5668\uff08\u6bd4\u5982 16GB \u5185\u5b58\u7684 MacBook Pro\uff09\uff0c\u5728\u7a7a\u4f59\u5185\u5b58\u4e0d\u8db3\u7684\u60c5\u51b5\u4e0b\u4f1a\u4f7f\u7528\u786c\u76d8\u4e0a\u7684\u865a\u62df\u5185\u5b58\uff0c\u5bfc\u81f4\u63a8\u7406\u901f\u5ea6\u4e25\u91cd\u53d8\u6162\u3002\n\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u91cf\u5316\u540e\u7684\u6a21\u578b chatglm2-6b-int4\u3002\u56e0\u4e3a GPU \u4e0a\u91cf\u5316\u7684 kernel \u662f\u4f7f\u7528 CUDA \u7f16\u5199\u7684\uff0c\u56e0\u6b64\u65e0\u6cd5\u5728 MacOS \u4e0a\u4f7f\u7528\uff0c\u53ea\u80fd\u4f7f\u7528 CPU \u8fdb\u884c\u63a8\u7406\u3002\n\u4e3a\u4e86\u5145\u5206\u4f7f\u7528 CPU \u5e76\u884c\uff0c\u8fd8\u9700\u8981[\u5355\u72ec\u5b89\u88c5 OpenMP](FAQ.md#q1)\u3002\n\n\u5728 Mac \u4e0a\u8fdb\u884c\u63a8\u7406\u4e5f\u53ef\u4ee5\u4f7f\u7528 [ChatGLM.cpp](https://github.com/li-plus/chatglm.cpp)\n\n### \u591a\u5361\u90e8\u7f72\n\u5982\u679c\u4f60\u6709\u591a\u5f20 GPU\uff0c\u4f46\u662f\u6bcf\u5f20 GPU \u7684\u663e\u5b58\u5927\u5c0f\u90fd\u4e0d\u8db3\u4ee5\u5bb9\u7eb3\u5b8c\u6574\u7684\u6a21\u578b\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u6a21\u578b\u5207\u5206\u5728\u591a\u5f20GPU\u4e0a\u3002\u9996\u5148\u5b89\u88c5 accelerate: `pip install accelerate`\uff0c\u7136\u540e\u901a\u8fc7\u5982\u4e0b\u65b9\u6cd5\u52a0\u8f7d\u6a21\u578b\uff1a\n```python\nfrom utils import load_model_on_gpus\nmodel = load_model_on_gpus(\"THUDM/chatglm2-6b\", num_gpus=2)\n```\n\u5373\u53ef\u5c06\u6a21\u578b\u90e8\u7f72\u5230\u4e24\u5f20 GPU \u4e0a\u8fdb\u884c\u63a8\u7406\u3002\u4f60\u53ef\u4ee5\u5c06 `num_gpus` \u6539\u4e3a\u4f60\u5e0c\u671b\u4f7f\u7528\u7684 GPU \u6570\u3002\u9ed8\u8ba4\u662f\u5747\u5300\u5207\u5206\u7684\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f20\u5165 `device_map` \u53c2\u6570\u6765\u81ea\u5df1\u6307\u5b9a\u3002 \n\n## \u534f\u8bae\n\n\u672c\u4ed3\u5e93\u7684\u4ee3\u7801\u4f9d\u7167 [Apache-2.0](https://www.apache.org/licenses/LICENSE-2.0) \u534f\u8bae\u5f00\u6e90\uff0cChatGLM2-6B \u6a21\u578b\u7684\u6743\u91cd\u7684\u4f7f\u7528\u5219\u9700\u8981\u9075\u5faa [Model License](MODEL_LICENSE)\u3002ChatGLM2-6B \u6743\u91cd\u5bf9\u5b66\u672f\u7814\u7a76**\u5b8c\u5168\u5f00\u653e**\uff0c\u5728\u586b\u5199[\u95ee\u5377](https://open.bigmodel.cn/mla/form)\u8fdb\u884c\u767b\u8bb0\u540e**\u4ea6\u5141\u8bb8\u514d\u8d39\u5546\u4e1a\u4f7f\u7528**\u3002\n\n\n## \u5f15\u7528\n\n\u5982\u679c\u4f60\u89c9\u5f97\u6211\u4eec\u7684\u5de5\u4f5c\u6709\u5e2e\u52a9\u7684\u8bdd\uff0c\u8bf7\u8003\u8651\u5f15\u7528\u4e0b\u5217\u8bba\u6587\uff0cChatGLM2-6B \u7684\u8bba\u6587\u4f1a\u5728\u8fd1\u671f\u516c\u5e03\uff0c\u656c\u8bf7\u671f\u5f85\uff5e\n\n```\n@misc{glm2024chatglm,\n      title={ChatGLM: A Family of Large Language Models from GLM-130B to GLM-4 All Tools}, \n      author={Team GLM and Aohan Zeng and Bin Xu and Bowen Wang and Chenhui Zhang and Da Yin and Diego Rojas and Guanyu Feng and Hanlin Zhao and Hanyu Lai and Hao Yu and Hongning Wang and Jiadai Sun and Jiajie Zhang and Jiale Cheng and Jiayi Gui and Jie Tang and Jing Zhang and Juanzi Li and Lei Zhao and Lindong Wu and Lucen Zhong and Mingdao Liu and Minlie Huang and Peng Zhang and Qinkai Zheng and Rui Lu and Shuaiqi Duan and Shudan Zhang and Shulin Cao and Shuxun Yang and Weng Lam Tam and Wenyi Zhao and Xiao Liu and Xiao Xia and Xiaohan Zhang and Xiaotao Gu and Xin Lv and Xinghan Liu and Xinyi Liu and Xinyue Yang and Xixuan Song and Xunkai Zhang and Yifan An and Yifan Xu and Yilin Niu and Yuantao Yang and Yueyan Li and Yushi Bai and Yuxiao Dong and Zehan Qi and Zhaoyu Wang and Zhen Yang and Zhengxiao Du and Zhenyu Hou and Zihan Wang},\n      year={2024},\n      eprint={2406.12793},\n      archivePrefix={arXiv},\n      primaryClass={id='cs.CL' full_name='Computation and Language' is_active=True alt_name='cmp-lg' in_archive='cs' is_general=False description='Covers natural language processing. Roughly includes material in ACM Subject Class I.2.7. Note that work on artificial languages (programming languages, logics, formal systems) that does not explicitly address natural-language issues broadly construed (natural-language processing, computational linguistics, speech, text retrieval, etc.) is not appropriate for this area.'}\n}\n```\n",
        "releases": []
    }
}